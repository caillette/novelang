gunit AntlrPart ;

@header {
  package novelang.parser.antlr ;
}

// Need to use this rule because an expected AST must define only one tree.
// So we can't use paragraphBody here.
paragraph :

//
// Punctuation signs.
//

"w0," -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_COMMA))
"w0;" -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_SEMICOLON))
"w0." -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_FULLSTOP))
"w0?" -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_QUESTIONMARK))
"w0!" -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_EXCLAMATIONMARK))
"w0:" -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_COLON))
"w0..." -> (PARAGRAPH_PLAIN (WORD w0) (PUNCTUATION_SIGN SIGN_ELLIPSIS))

"w0, w1 ; w2. w3 ? w4 ! w5 : w6..." OK

/*
"w0.." FAIL
"w0,," FAIL
"w0??" FAIL
"w0;;" FAIL
*/

"w0 w1'/w2/." -> (PARAGRAPH_PLAIN (WORD w0) (WORD w1') (EMPHASIS (WORD w2)) (PUNCTUATION_SIGN SIGN_FULLSTOP))

<<w0 /w1
w2/.>>    OK


paragraphBody :

//
// Emphasis.
//
"/w0/" -> (EMPHASIS (WORD w0))


//
// Parenthesis.
//
"(w0)" -> (PARENTHESIS (WORD w0))


//
// Quote.
//
<<"w0">> -> (QUOTE (WORD w0))


//
// Interpolated clause.
//
"-- w0 --" -> (INTERPOLATEDCLAUSE (WORD w0))
"-- w0 -_" -> (INTERPOLATEDCLAUSE_SILENTEND (WORD w0))


//
// Some amazing combinations.
//
<<"w0">>                  OK
<<"w0 (w1)">>             OK
<<"w0 (w1 /w2/)">>        OK
<<"w0 (w1 /w2 (w3)/)">>   OK
<<"(w0 -- w1 (w2) --)">>  OK
<</w0/>>                  OK
<</w0 (w1)/.>>            OK
<</w0 (w1, "w62")/ ?>>    OK
<<(w0 !)>>                OK
<<(w0 "w1"...)>>          OK
<<(w0 "w1 /w2/") : w3 !>> OK

<<(w0 "w1 (w2 "w3")")>>          FAIL // Quote depth limited to 1.
<<(w0 /w1 (w2 /w3/)/)>>          FAIL // Emphasis depth limited to 1.
<<(w0 /w1 (w2 "w3 (w4)")/)>>     FAIL // Parenthesis depth limited to 2.
<<(w0 -- w1 (w2 -- w3 -- ) --)>> FAIL // Interpolated clauses depth limited to 1.






